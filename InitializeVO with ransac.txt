function [ pose, state ] = InitializeVO( frame_1, frame_2, K )

% This function is set to initialize the VO pipeline. In particular, it is
% possible to choose between stereo initialization and monocular
% initialization.
% Inputs : - frame_1 = first image frame (left in stereo case);
%          - frame_2 = second image frame (right in stereo case);
%          - K       = intrinsic camera matrix;
% Outputs: - pose    = initial pose of the camera;
%          - state   = initial state.

use_stereo = true;

% Initial parameters set
harris_patch_size = 9;
harris_kappa = 0.08;
num_keypoints = 516;
nonmaximum_supression_radius = 6;
patch_radius = 5;
min_disp = 5;
max_disp = 50;

% For KITTY dataset 
baseline = 0.54;

if use_stereo
    img_left = frame_1;
    img_right = frame_2;
    % Extraction of keypoints set in I0_left (Harris detector)
    scores_left = harris(img_left,harris_patch_size,harris_kappa);
    assert(min(size(scores_left) == size(img_left))); % Check-point
    % Select the best keypoints in the left image
    keypoints_left = selectKeypoints(...
        scores_left, num_keypoints, nonmaximum_supression_radius);
    
    % Establish correspondences
    disp_img = ourGetDisparity(img_left,img_right,patch_radius,min_disp,max_disp);
    % 3D landmarks points
    % Take the 3D points that correspond to the keypoints
    [p_W_landmarks, keypoints_left] = ourDisparityToPointCloud(...
        disp_img,K,baseline,img_left,keypoints_left);
    
    % Perform RANSAC to remove outliers
    [R_C_W, t_C_W, ~, all_matches, inlier_mask] = ransacLocalization(...
        img_right, img_left, keypoints_left, p_W_landmarks, K);
    matched_keypoints = keypoints_left(:,all_matches>0);
    matched_landmarks = p_W_landmarks(:,all_matches>0);
    matched_keypoints = matched_keypoints(:,inlier_mask>0);
    matched_landmarks = matched_landmarks(:,inlier_mask>0);
    
    % Function outputs
    pose = [R_C_W, t_C_W];
    state = [matched_keypoints; matched_landmarks];
end

% MONOCULAR : to be done
end